# NGINX Port Assign

This script assigns ports to virtual servers and their subdomains. The script will read the config file, and for each server and it's array of subdomains, it will generate a single nginx.conf (that includes the true domain and a `*.localhost.xyz` domain) file for each entry assigning it a unique port and exporting that port in an env variable.

## Usage

```bash
$ python3 npa.py -h
usage: npa.py [-h] [--config CONFIG] [--start START] [--dry-run] [--reload] [--certbot] [--hosts] --user USER

Assigns ports to nginx services

optional arguments:
  -h, --help       show this help message and exit
  --config CONFIG  Path to nginx config file
  --start START    Port to start counting at
  --dry-run        Print actions instead of doing them
  --reload         Reload nginx
  --certbot        Run certbot
  --hosts          Update /etc/hosts
  --user USER      User to run exports as
```

### --config config.json syntax

```json
{
  "SERVER NAME": [
    "subdomain1",
    "subdomain2",
    "subdomain3",
  ],
  "OTHER SERVER NAME": [
    "subdomain1",
    "subdomain2",
    "subdomain3",
  ]
}
```

### --start START

Unique ports are generated by incrementing from this starting port, 3000 by default

### --dry-run

Prints the actions the script will do before actually doing them

### --reload

Reloads nginx when finished

### --certbot

Runs `certbot --nginx` for all the domains and subdomains

### --hosts

Updates your `/etc/hosts` file to include all the `*.localhost.xyz` domains. This requires `# NPA START HERE` and `# NPA END HERE` lines to be included for the domains to be written into.

### --user user

Creates a file at `/home/${user}/.npa_exports` where all the port enviroment variables will be written. Please be sure to include `source .npa_exports` in your `.bashrc` for these to work.
